{% extends 'admin_dashboard/base.html' %}

{% block title %}Song Details | Admin Dashboard{% endblock %}

{% block header_title %}Song Submission Details{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <!-- Song Information -->
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span>Song Information</span>
                <div>
                    {% if song.is_approved %}
                    <a href="{% url 'admin_dashboard:song_reject' song.id %}" class="btn btn-sm btn-outline-danger">
                        <i class="fas fa-times me-1"></i> Reject
                    </a>
                    {% else %}
                    <a href="{% url 'admin_dashboard:song_approve' song.id %}" class="btn btn-sm btn-outline-success">
                        <i class="fas fa-check me-1"></i> Approve
                    </a>
                    {% endif %}
                </div>
            </div>
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-md-6">
                        <h5 class="mb-3">{{ song.song_title }}</h5>
                        <p class="mb-2"><strong>Artist:</strong> {{ song.artist_name }}</p>
                        <p class="mb-2"><strong>Genre:</strong> {{ song.get_genre_display }}</p>
                        <p class="mb-2">
                            <strong>Status:</strong>
                            {% if song.is_approved %}
                            <span class="badge badge-approved">Approved</span>
                            {% else %}
                            <span class="badge badge-pending">Pending</span>
                            {% endif %}
                        </p>
                    </div>
                    <div class="col-md-6">
                        <p class="mb-2"><strong>Submitted:</strong> {{ song.submission_date|date:"F j, Y H:i" }}</p>
                        <p class="mb-2">
                            <strong>Payment Status:</strong>
                            {% if song.payment_status == 'completed' %}
                            <span class="badge badge-completed">Paid</span>
                            {% elif song.payment_status == 'failed' %}
                            <span class="badge badge-failed">Failed</span>
                            {% else %}
                            <span class="badge badge-pending">Pending</span>
                            {% endif %}
                        </p>
                        {% if song.package %}
                        <p class="mb-2"><strong>Package:</strong> {{ song.package.name }}</p>
                        <p class="mb-2"><strong>Price:</strong> ₦{{ song.package.price }}</p>
                        {% endif %}
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6>Music Link</h6>
                    <div class="input-group">
                        <input type="text" class="form-control" value="{{ song.music_link }}" readonly>
                        <a href="{{ song.music_link }}" target="_blank" class="btn btn-outline-secondary">
                            <i class="fas fa-external-link-alt"></i> Open
                        </a>
                    </div>
                    <small class="text-muted">Link Type: {{ song.get_link_type_display }}</small>
                </div>
                
                {% if song.song_file %}
                <div class="mb-4">
                    <h6>Uploaded File</h6>
                    <div class="input-group">
                        <input type="text" class="form-control" value="{{ song.song_file.name }}" readonly>
                        <a href="{{ song.song_file.url }}" class="btn btn-outline-secondary">
                            <i class="fas fa-download"></i> Download
                        </a>
                    </div>
                </div>
                {% endif %}
                
                {% if song.bio %}
                <div class="mb-4">
                    <h6>Artist Bio</h6>
                    <div class="p-3 bg-light rounded">
                        {{ song.bio|linebreaks }}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Admin Notes -->
        <div class="card mb-4">
            <div class="card-header">Admin Notes</div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    <div class="mb-3">
                        <textarea name="notes" class="form-control" rows="5" placeholder="Add notes about this submission...">{{ song.notes }}</textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i> Save Notes
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <!-- Contact Information -->
        <div class="card mb-4">
            <div class="card-header">Contact Information</div>
            <div class="card-body">
                <p><strong>Email:</strong> <a href="mailto:{{ song.email }}">{{ song.email }}</a></p>
                {% if song.phone %}
                <p><strong>Phone:</strong> {{ song.phone }}</p>
                {% endif %}
                {% if song.social_media %}
                <p><strong>Social Media:</strong> {{ song.social_media }}</p>
                {% endif %}
                
                {% if song.user %}
                <hr>
                <p><strong>Registered User:</strong> {{ song.user.username }}</p>
                <p><strong>User ID:</strong> {{ song.user.id }}</p>
                <p><strong>Joined:</strong> {{ song.user.date_joined|date:"F j, Y" }}</p>
                {% endif %}
            </div>
        </div>
        
        {% if song.payment_status == 'completed' %}
        <!-- Payment Details -->
        <div class="card mb-4">
            <div class="card-header">Payment Details</div>
            <div class="card-body">
                <p><strong>Transaction ID:</strong> <span class="text-monospace">{{ song.transaction_reference }}</span></p>
                <p><strong>Payment Date:</strong> {{ song.payment_date|date:"F j, Y H:i" }}</p>
                <p><strong>Amount:</strong> ₦{{ song.package.price }}</p>
            </div>
        </div>
        {% endif %}
        
        <!-- Quick Actions -->
        <div class="card">
            <div class="card-header">Quick Actions</div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'admin_dashboard:song_list' %}" class="btn btn-outline-primary">
                        <i class="fas fa-arrow-left me-2"></i> Back to List
                    </a>
                    {% if song.is_approved %}
                    <a href="{% url 'admin_dashboard:song_reject' song.id %}" class="btn btn-outline-danger">
                        <i class="fas fa-times me-2"></i> Reject Submission
                    </a>
                    {% else %}
                    <a href="{% url 'admin_dashboard:song_approve' song.id %}" class="btn btn-outline-success">
                        <i class="fas fa-check me-2"></i> Approve Submission
                    </a>
                    {% endif %}
                    <a href="mailto:{{ song.email }}" class="btn btn-outline-info">
                        <i class="fas fa-envelope me-2"></i> Email Artist
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% extends 'admin_dashboard/base.html' %}

{% block title %}Payments | Admin Dashboard{% endblock %}

{% block header_title %}Payment Management{% endblock %}

{% block content %}
<!-- Filter Section -->
<div class="filter-section">
    <form method="get" class="row g-3 align-items-end">
        <div class="col-md-3">
            <label for="status" class="form-label">Payment Status</label>
            <select name="status" id="status" class="form-select">
                <option value="">All Statuses</option>
                {% for status_code, status_name in payment_status_choices %}
                <option value="{{ status_code }}" {% if status == status_code %}selected{% endif %}>{{ status_name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-7">
            <label for="search" class="form-label">Search</label>
            <input type="text" name="search" id="search" class="form-control" placeholder="Search by artist, song, email, transaction ID..." value="{{ search }}">
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">
                <i class="fas fa-search me-2"></i> Filter
            </button>
        </div>
    </form>
</div>

<!-- Payments Table -->
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <span>Payment Records</span>
        <span class="badge bg-secondary">{{ payments.count }} results</span>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Artist</th>
                        <th>Song</th>
                        <th>Package</th>
                        <th>Amount</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Transaction ID</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for payment in payments %}
                    <tr>
                        <td>{{ payment.id }}</td>
                        <td>{{ payment.artist_name }}</td>
                        <td>{{ payment.song_title }}</td>
                        <td>{{ payment.package.name|default:"N/A" }}</td>
                        <td>â‚¦{{ payment.package.price|default:"0.00" }}</td>
                        <td>{% if payment.payment_date %}{{ payment.payment_date|date:"M d, Y" }}{% else %}N/A{% endif %}</td>
                        <td>
                            {% if payment.payment_status == 'completed' %}
                            <span class="badge badge-completed">Completed</span>
                            {% elif payment.payment_status == 'failed' %}
                            <span class="badge badge-failed">Failed</span>
                            {% else %}
                            <span class="badge badge-pending">Pending</span>
                            {% endif %}
                        </td>
                        <td>
                            <span class="text-monospace">{{ payment.transaction_reference|truncatechars:10 }}</span>
                        </td>
                        <td>
                            <a href="{% url 'admin_dashboard:payment_detail' payment.id %}" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-eye"></i>
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="9" class="text-center py-4">
                            <p class="text-muted">No payment records found matching your criteria.</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}